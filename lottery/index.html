<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ㄚ亮笑長的抽抽樂</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="p-4 pb-16">

    <div class="w-full max-w-5xl mx-auto">
        <header class="text-center my-8">
            <div class="relative flex items-center justify-center">
                <h1 id="main-title" class="text-5xl md:text-6xl font-bold izakaya-title">ㄚ亮笑長的抽抽樂</h1>
                <button id="reset-btn" class="absolute right-0 text-3xl p-2 rounded-full hidden hover:bg-white/10 transition-colors" style="color: var(--text-muted-color);" title="重置並返回設定">⟲</button>
            </div>
        </header>

        <section id="settings-section" class="space-y-6">
            
            <div class="card p-8 rounded-lg">
                 <h2 class="text-2xl font-bold mb-4" style="color: var(--accent-color);">環境設定</h2>
                 <div class="border-b" style="border-color: var(--input-border-color);">
                    <nav class="-mb-px flex space-x-6 overflow-x-auto" aria-label="Tabs">
                        <button id="tab-mode" class="tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">模式設定</button>
                        <button id="tab-title" class="tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">標題設定</button>
                        <button id="tab-prize" class="tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">獎項設定</button>
                        <button id="tab-theme" class="tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">布景主題</button>
                        <button id="tab-sound" class="tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">音效開關</button>
                        <button id="tab-effect" class="tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">特效設定</button>
                    </nav>
                </div>

                <div id="tab-content-mode" class="hidden mt-6">
                    <div class="flex items-center justify-between">
                        <div class="flex flex-col">
                            <span class="font-semibold text-lg" style="color: var(--text-color);">啟用單純抽籤模式</span>
                            <span class="text-sm" style="color: var(--text-muted-color);">將隱藏獎項設定，變為純粹的抽籤工具。</span>
                        </div>
                        <label for="simple-draw-toggle" class="inline-flex relative items-center cursor-pointer">
                            <input type="checkbox" id="simple-draw-toggle" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 toggle-switch-bg peer-checked:bg-red-500"></div>
                        </label>
                    </div>
                </div>

                <div id="tab-content-title" class="hidden mt-6 space-y-4">
                    <div class="mb-4">
                        <label class="block mb-2 font-semibold" style="color: var(--accent-color);">儲存目前標題為範本</label>
                        <div class="flex gap-2">
                            <input type="text" id="title-template-name-input" class="form-input w-full p-2 rounded" placeholder="請輸入範本名稱">
                            <button id="save-title-template-btn" class="btn-primary px-4 py-2 rounded-lg text-sm flex-shrink-0">儲存</button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block mb-2 font-semibold" style="color: var(--accent-color);">載入標題範本</label>
                        <div id="title-template-buttons-container" class="flex flex-wrap gap-2"></div>
                    </div>
                    <hr style="border-color: var(--input-border-color);" class="my-4">
                    <div>
                        <label for="title-input" class="block mb-1 font-semibold" style="color: var(--accent-color);">摸彩活動標題</label>
                        <input type="text" id="title-input" class="form-input w-full p-2 rounded" placeholder="請輸入新的標題">
                    </div>
                </div>
                
                <div id="tab-content-prize" class="hidden mt-6">
                    <div class="mb-4">
                        <label class="block mb-2 font-semibold" style="color: var(--accent-color);">儲存目前獎項為範本</label>
                        <div class="flex gap-2">
                            <input type="text" id="template-name-input" class="form-input w-full p-2 rounded" placeholder="請輸入範本名稱">
                            <button id="save-template-btn" class="btn-primary px-4 py-2 rounded-lg text-sm flex-shrink-0">儲存</button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block mb-2 font-semibold" style="color: var(--accent-color);">載入獎項範本</label>
                        <div id="template-buttons-container" class="flex flex-wrap gap-2"></div>
                    </div>
                    <hr style="border-color: var(--input-border-color);" class="my-4">
                    <div id="prizes-container" class="space-y-3"></div>
                    <div class="flex gap-4 mt-4">
                        <button id="add-prize-btn" class="w-full btn-secondary py-2 rounded-lg text-lg font-bold">＋ 新增獎項</button>
                        <button id="clear-prizes-btn" class="w-full btn-secondary py-2 rounded-lg text-lg font-bold" style="background-color: var(--danger-color);">清空獎項</button>
                    </div>
                </div>
                
                <div id="tab-content-theme" class="hidden mt-6">
                    <div class="flex items-center justify-between">
                        <span class="font-semibold text-lg" style="color: var(--text-color);">選擇一個您喜歡的風格</span>
                        <div id="theme-selector" class="flex items-center justify-center gap-3"></div>
                    </div>
                </div>

                <div id="tab-content-sound" class="hidden mt-6">
                    <div class="flex items-center justify-between">
                         <span class="font-semibold text-lg" style="color: var(--text-color);">點擊圖示以開啟或關閉音效</span>
                         <button id="sound-toggle-btn" class="text-3xl p-2 rounded-full transition-colors duration-300 hover:bg-white/10" aria-label="切換音效">🔊</button>
                    </div>
                </div>

                <div id="tab-content-effect" class="hidden mt-6">
                    <div>
                        <label for="winner-effect-select" class="block mb-2 font-semibold" style="color: var(--accent-color);">中獎動畫特效</label>
                        <select id="winner-effect-select" class="form-input w-full p-2 rounded">
                            <option value="none">標準效果</option>
                            <option value="spotlight">聚光燈效果</option>
                            <option value="marquee">文字跑馬燈</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="card p-8 rounded-lg">
                <h2 class="text-2xl font-bold mb-4" style="color: var(--accent-color);">名單設定</h2>
                <div class="border-b" style="border-color: var(--input-border-color);">
                    <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                        <button id="tab-custom" class="tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                            自訂名單
                        </button>
                        <button id="tab-cloud" class="tab-btn whitespace-nowrap py-3 px-1 border-b-2 font-medium text-lg">
                            雲端名單
                        </button>
                    </nav>
                </div>
                
                <div id="tab-content-custom" class="hidden mt-6 space-y-4">
                    <div class="mb-4">
                        <label class="block mb-2 font-semibold" style="color: var(--accent-color);">儲存目前名單為範本</label>
                        <div class="flex gap-2">
                            <input type="text" id="list-template-name-input" class="form-input w-full p-2 rounded" placeholder="請輸入範本名稱">
                            <button id="save-list-template-btn" class="btn-primary px-4 py-2 rounded-lg text-sm flex-shrink-0">儲存</button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block mb-2 font-semibold" style="color: var(--accent-color);">載入名單範本</label>
                        <div id="list-template-buttons-container" class="flex flex-wrap gap-2"></div>
                    </div>
                    <hr style="border-color: var(--input-border-color);" class="my-4">
                     <div>
                        <label for="custom-list" class="block mb-1 font-semibold" style="color: var(--accent-color);">參與人員名單</label>
                        <textarea id="custom-list" rows="6" class="form-input w-full p-2 rounded" placeholder="請在此輸入名單..."></textarea>
                        <p class="text-sm mt-2" style="color: var(--text-muted-color);">提示：一行一個名字，或用半形逗號「,」隔開。</p>
                    </div>
                </div>

                <div id="tab-content-cloud" class="hidden mt-6">
                    <div class="space-y-4">
                        <div>
                            <label for="sheet-url" class="block mb-1 font-semibold" style="color: var(--accent-color);">Google 試算表網址</label>
                            <input type="url" id="sheet-url" class="form-input w-full p-2 rounded" placeholder="貼上完整的 Google 試算表共用連結">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="sheet-name" class="block mb-1 font-semibold" style="color: var(--accent-color);">工作表名稱</label>
                                <input type="text" id="sheet-name" class="form-input w-full p-2 rounded" value="工作表1">
                            </div>
                            <div>
                                <label for="column-letter" class="block mb-1 font-semibold" style="color: var(--accent-color);">名單在哪一欄？</label>
                                <input type="text" id="column-letter" maxlength="2" class="form-input w-full p-2 rounded" value="A" placeholder="A, B, C...">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 space-y-4">
                <div class="flex flex-col md:flex-row gap-4">
                    <button id="generate-link-btn" class="w-full md:w-1/2 btn-secondary py-3 rounded-lg text-xl font-bold">產生獨立摸彩連結</button>
                    <button id="load-button" class="w-full md:w-1/2 btn-primary py-3 rounded-lg text-xl font-bold">載入名單並開始</button>
                </div>
                <div id="link-output-container" class="hidden mt-2 flex gap-2">
                    <input type="text" id="share-link-output" class="form-input w-full p-2 rounded" readonly>
                    <button id="copy-link-btn" class="btn-primary px-4 py-2 text-xl rounded" aria-label="複製連結">📋</button>
                </div>
            </div>

            <p id="status-message" class="text-center mt-4 h-6" style="color: var(--accent-color);"></p>
        </section>

        <section id="lottery-section" class="hidden flex flex-col md:flex-row gap-6 items-start">
            <div id="main-draw-panel" class="w-full md:w-full card p-8 rounded-lg">
                 <div class="flex flex-col sm:flex-row justify-end items-center mb-4 gap-2">
                     <p><span id="participant-label">剩餘摸彩人數</span>: <span id="participant-count" class="font-bold text-2xl" style="color: var(--accent-color);">0</span></p>
                </div>
                <h3 id="current-prize-display" class="text-3xl text-center mb-4 font-bold" style="color: var(--accent-color);"></h3>
                <div id="winner-display" class="winner-display rounded-lg p-4 mb-6 text-4xl md:text-6xl">
                    準備開始！
                </div>
                <div class="flex gap-4">
                    <button id="draw-button" class="btn-primary w-full py-4 rounded-lg text-2xl font-bold">開始摸彩</button>
                    <button id="end-draw-btn" class="btn-secondary px-8 py-4 rounded-lg text-xl font-bold hidden flex-shrink-0">結束抽籤</button>
                </div>
            </div>
             <div id="winners-list-container" class="w-full md:w-[30%] hidden">
                <div class="card p-6 rounded-lg">
                    <h3 id="winners-list-title" class="text-xl font-bold text-center mb-4" style="color: var(--accent-color);">🎉 得獎名單 🎉</h3>
                    <div id="winners-list" class="space-y-4 text-center text-lg">
                    </div>
                    <button id="export-csv-btn" class="hidden mt-4 btn-secondary w-full py-3 rounded-lg text-xl font-bold">匯出得獎名單</button>
                </div>
            </div>
        </section>
        
    </div>
     <audio id="rolling-sound" src="https://hsuliang.github.io/rool5.mp3" preload="auto" loop></audio>
    <audio id="winner-sound" src="https://hsuliang.github.io/happy.mp3" preload="auto"></audio>

    <div id="version-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 transition-opacity duration-300 ease-in-out opacity-0 pointer-events-none">
        <div class="modal-content card w-full max-w-lg rounded-lg p-8 relative transform scale-95 transition-transform duration-300 ease-in-out">
            <button id="close-modal-btn" class="absolute top-2 right-3 hover:text-white text-3xl leading-none font-bold" style="color: var(--text-muted-color);">&times;</button>
            <h3 class="text-xl font-bold text-center mb-4" style="color: var(--accent-color);">版本更新紀錄</h3>
            <ul class="space-y-4 max-h-[60vh] overflow-y-auto pr-4" style="color: var(--text-color);">
                <li>
                    <strong style="color: var(--accent-color);">v2.5.5 (2025-10-01)</strong>
                    <ul class="list-disc list-inside pl-4 mt-1 space-y-1 text-sm">
                        <li>「抽籤模式」標題改為沿用主標題，增加彈性。</li>
                        <li>「摸彩模式」新增中途重置按鈕 (⟲)，可隨時返回設定頁。</li>
                    </ul>
                </li>
                <li>
                    <strong style="color: var(--accent-color);">v2.5.4 (2025-10-01)</strong>
                    <ul class="list-disc list-inside pl-4 mt-1 space-y-1 text-sm">
                        <li>「自訂名單」新增範本儲存、載入與刪除功能。</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
    
    <footer class="fixed bottom-0 left-0 right-0 p-3 text-center text-xs backdrop-blur-sm" style="color: var(--text-muted-color); background-color: var(--footer-bg);">
        <span id="version-btn" class="cursor-pointer hover:text-white transition-colors">v2.5.5</span> |
        <span>由 Google Gemini 強力驅動</span> |
        <a href="https://bit.ly/Alaing" target="_blank" rel="noopener noreferrer" class="hover:text-white transition-colors">ㄚ亮笑長練功坊</a>
    </footer>

    <script src="script.js"></script>
</body>
</html>